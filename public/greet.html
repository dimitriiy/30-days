<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />

    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="css/stolen-styles.css" />
    <link rel="stylesheet" href="css/styles.css" />

    <title>–° –Ω–æ–≤—ã–º –≥–æ–¥–æ–º!</title>
  </head>
  <link rel="preconnect" href="https://fonts.googleapis.com" />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pattaya&family=Marck+Script&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flipdown@0.3.2/dist/flipdown.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/flipdown@0.3.2/src/flipdown.min.js"></script>

  <!-- <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet"
  /> -->
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
  <link rel="stylesheet" href="/resources/demos/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/flipdown@0.3.2/dist/flipdown.min.css" rel="stylesheet" />
  <script defer src="https://cdn.tailwindcss.com"></script>
  <script
    defer
    src="
  https://cdn.jsdelivr.net/npm/tailwindcss-animated@1.0.1/src/index.min.js
  "
  ></script> -->
  <!-- <script defer src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script> -->
  <!-- <script defer src="https://code.jquery.com/jquery-3.6.0.js"></script> -->
  <!-- <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script> -->
  <!-- <script defer src="https://cdn.jsdelivr.net/npm/flipdown@0.3.2/src/flipdown.min.js"></script> -->
  <script defer src="https://unpkg.com/fireworks-js@2.x/dist/index.umd.js" defer></script>
  <!-- <script defer type="module" src="js/utils.js"></script>
  <script defer type="module" src="js/api.js"></script>
  <script defer type="module" src="js/view.js"></script>
  <script defer type="module" src="js/index.js"></script> -->

  <body>
    <div class="bbox">
      <div id="main-countdown" class="flipdown"></div>
    </div>

    <div class="bg-lights" id="lights"></div>

    <div class="ornament ornament-1"></div>
    <div class="ornament ornament-2"></div>

    <div class="container container-filter">
      <div class="card">
        <h1 class="title main-title">‚ú® –° –Ω–æ–≤—ã–º –≥–æ–¥–æ–º ‚ú®</h1>

        <!-- –°–µ–∫—Ü–∏—è –ª–æ–≥–∏–Ω–∞ -->
        <div class="login-section" id="loginSection">
          <div class="form-group">
            <label for="password">–°–ª–æ–≤–æ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ –≤ —Ä–µ–±—É—Å–µ</label>
            <input type="input" id="ans" placeholder="–í–≤–µ–¥–∏ —Å–ª–æ–≤–æ..." autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="password">–ú–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ:</label>
            <input type="input" id="password" placeholder="–í–≤–µ–¥–∏ —Å–ª–æ–≤–æ..." autocomplete="off" />
          </div>

          <button class="btn btn-primary" id="submitBtn">–í–æ–π—Ç–∏</button>
          <div class="error-message hidden-error" id="errorMsg"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="greeting-section" id="greetingSection">
          <h2 class="greeting-title">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! üéâ</h2>
          <!-- <p class="greeting-text"></p> -->
          <p class="greeting-text">–ü—É—Å—Ç—å —ç—Ç–æ—Ç –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–µ–±–µ —Ä–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∂–µ–ª–∞–Ω–∏–π!</p>
          <button class="btn btn-download" id="downloadBtn">üì• –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
        </div>
      </div>
    </div>
    <audio autoplay src="./output.mp3"></audio>
    <script>
      // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–æ–∫
      function createSnowflakes() {
        const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚õÑ'];
        setInterval(() => {
          const snowflake = document.createElement('div');
          snowflake.classList.add('snowflake');
          snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
          snowflake.style.left = Math.random() * window.innerWidth + 'px';
          snowflake.style.animationDuration = Math.random() * 5 + 10 + 's';
          snowflake.style.fontSize = Math.random() * 1.5 + 0.5 + 'em';
          document.body.appendChild(snowflake);

          setTimeout(() => snowflake.remove(), 15000);
        }, 300);
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö –æ–≥–æ–Ω—å–∫–æ–≤
      function createLights() {
        const lightsContainer = document.getElementById('lights');
        for (let i = 0; i < 30; i++) {
          const light = document.createElement('div');
          light.classList.add('light');
          light.style.left = Math.random() * 100 + '%';
          light.style.top = Math.random() * 100 + '%';
          light.style.animationDuration = Math.random() * 3 + 2 + 's';
          light.style.animationDelay = Math.random() * 3 + 's';
          lightsContainer.appendChild(light);
        }
      }

      // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç
      function createConfetti() {
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement('div');
          confetti.classList.add('confetti');
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = -10 + 'px';
          confetti.style.backgroundColor = ['#ffd700', '#32b8c6', '#ff6b6b', '#4ecdc4'][Math.floor(Math.random() * 4)];
          confetti.style.animation = `snowfall ${Math.random() * 3 + 2}s linear infinite`;
          document.body.appendChild(confetti);

          setTimeout(() => confetti.remove(), (Math.random() * 3 + 2) * 1000);
        }
      }

      function upperFirstLet(text) {
        return `${text.substring(0, 1).toUpperCase()}${text.substring(1)}`;
      }

      const encodeBase64 = (str) => btoa(String.fromCharCode(...new TextEncoder().encode(str)));

      const decodeBase64 = (b64) => new TextDecoder().decode(Uint8Array.from(atob(b64), (c) => c.charCodeAt(0)));

      let pass;
      let answer;
      function sendGiftLogic() {
        const randoms = [
          '0Y7Qu9GP',
          '0Y3QtNC40Lo=',
          '0LzQsNGI0LA=',
          '0L7Qu9GP',
          '0YHQsNGI0LA=',
          '0L3QsNGC0LDRiNCw',
          '0LDQvdGP',
          '0LjRgNCw',
          '0LPQtdCy0LA=',
          '0LLQuNC60LA=',
        ];

        const answerInput = document.querySelector('#ans');

        const passwordInput = document.getElementById('password');
        const submitBtn = document.getElementById('submitBtn');
        const loginSection = document.getElementById('loginSection');
        const greetingSection = document.getElementById('greetingSection');
        const errorMsg = document.getElementById('errorMsg');
        const downloadBtn = document.getElementById('downloadBtn');

        submitBtn.addEventListener('click', () => {
          const enteredPassword = passwordInput.value.toLowerCase().trim();
          const ansRebus = answerInput.value.toLowerCase().trim();

          const decoded = encodeBase64(enteredPassword);

          answer = ansRebus;
          pass = enteredPassword;
          if (randoms.includes(decoded) && ansRebus === '–ª–æ—à–∞–¥—å') {
            loginSection.classList.add('hidden');
            greetingSection.classList.add('show');
            document.querySelector('.main-title').innerHTML =
              `‚ú® –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º, ${upperFirstLet(enteredPassword)} ! ‚ú®`;
            createConfetti();

            //  <h1 class="title main-title">‚ú® –° –Ω–æ–≤—ã–º –≥–æ–¥–æ–º ‚ú®</h1>

            // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–∫–∏
            errorMsg.classList.add('hidden-error');
          } else {
            const errors = [];

            if (!randoms.includes(decoded)) {
              errors.push('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –º–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑...');
            }

            if (ansRebus !== '–ª–æ—à–∞–¥—å') {
              errors.push('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä–µ–±—É—Å. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑...');
            }

            errorMsg.textContent = errors.join('\n');
            errorMsg.classList.remove('hidden-error');
            passwordInput.value = '';
            passwordInput.focus();
          }
        });

        // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        passwordInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            submitBtn.click();
          }
        });

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        downloadBtn.addEventListener('click', () => {
          downloadFile({ answer, pass });
        });
      }
      function playSound() {
        const audio = document.querySelector('audio'); // or video
        const playPromise = audio.play();

        if (playPromise !== undefined) {
          playPromise
            .then(() => {})
            .catch((error) => {
              if (error.name === 'NotAllowedError') {
                const btn = document.createElement('button');
                btn.textContent = '–í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
                btn.classList.add('music-btn');
                btn.classList.add('btn');
                btn.onclick = (e) => {
                  audio.play();
                  e.target.remove();
                };
                document.body.appendChild(btn);
              }
            });
        }
      }

      createSnowflakes();
      createLights();
      sendGiftLogic();
      playSound();

      // const targetTimestamp = Date.UTC(2025, 11, 31, 20, 0);
      const targetTimestamp = Date.UTC(2025, 11, 30, 21, 6); // 30 –¥–µ–∫–∞–±—Ä—è UTC = 31 –¥–µ–∫–∞–±—Ä—è MSK

      const nowMSK = new Date().toLocaleString('en-US', { timeZone: 'Europe/Moscow' });

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—É–ø–∏–ª–æ –ª–∏ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è 31.12.2025 23:00 MSK
      const isTargetTime = new Date().getTime() >= targetTimestamp;

      if (!isTargetTime) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º FlipDown, –µ—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ
        const flipdown = new FlipDown(targetTimestamp / 1000, 'main-countdown').start().ifEnded(() => {
          // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
          document.querySelector('.container-filter')?.classList.remove('container-filter');
          document.querySelector('.bbox').remove();
        });
      } else {
        // –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ - —Å–∫—Ä—ã–≤–∞–µ–º FlipDown –∏ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å
        const countdownEl = document.getElementById('main-countdown');
        if (countdownEl) {
          countdownEl.style.display = 'none';
        }
        document.querySelector('.container-filter')?.classList.remove('container-filter');
        document.querySelector('.bbox').remove();
      }

      function downloadFile({ answer, pass }) {
        fetch('file', {
          method: 'POST',
          headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ answer, pass }),
        })
          .then((response) => response.blob())
          .then(async (data) => {
            console.log(data);
            const blob = new Blob([data], { type: 'application/pdf' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'ticket_basta.pdf';
            document.body.appendChild(link);
            link.click();
          });
      }
    </script>
  </body>
</html>
